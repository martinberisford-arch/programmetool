generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("PRISMA_DATABASE_URL")
  directUrl = env("POSTGRES_URL")
}

enum ItemStatus {
  ACTIVE
  INACTIVE
}

enum QuestionType {
  SINGLE
  MULTI
  YESNO
}

enum UserRole {
  ADMIN
  EDITOR
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  passwordHash  String
  name          String?
  role          UserRole  @default(ADMIN)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Programme {
  id          String      @id @default(cuid())
  name        String
  slug        String      @unique
  shortDesc   String
  longDesc    String?
  link        String?
  email       String?
  imageUrl    String?
  color       String?
  status      ItemStatus  @default(ACTIVE)
  order       Int         @default(0)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  rules       EligibilityRule[]

  @@index([status])
  @@index([order])
}

model Question {
  id               String      @id @default(cuid())
  text             String
  helpText         String?
  type             QuestionType
  options          Json?
  required         Boolean     @default(true)
  order            Int         @default(0)
  conditionalLogic Json?
  status           ItemStatus  @default(ACTIVE)
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt

  @@index([status])
  @@index([order])
}

model EligibilityRule {
  id          String    @id @default(cuid())
  programmeId String
  programme   Programme @relation(fields: [programmeId], references: [id], onDelete: Cascade)
  logic       Json
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([programmeId])
}

model Session {
  id              String    @id @default(cuid())
  sessionToken    String    @unique
  startedAt       DateTime  @default(now())
  completedAt     DateTime?
  completionTime  Int?
  deviceType      String?
  completed       Boolean   @default(false)
  responses       Response[]

  @@index([completed])
  @@index([startedAt])
}

model Response {
  id         String   @id @default(cuid())
  sessionId  String
  session    Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  questionId String
  answer     Json
  answeredAt DateTime @default(now())

  @@index([sessionId])
  @@index([questionId])
}

model Settings {
  id    String @id @default(cuid())
  key   String @unique
  value Json
}
